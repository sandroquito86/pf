<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista tree personalizada -->
    <record id="mz_view_picking_tree" model="ir.ui.view">
        <field name="name">mz.stock.picking.tree</field>
        <field name="model">stock.picking</field>
        <field name="arch" type="xml">
            <tree string="Transferencias">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="scheduled_date"/>
                <field name="origin"/>
                <field name="location_id" groups="stock.group_stock_multi_locations"/>
                <field name="location_dest_id" groups="stock.group_stock_multi_locations"/>
                <field name="state" widget="badge" decoration-danger="state=='cancel'" decoration-info="state=='assigned'" decoration-muted="state=='draft'" decoration-success="state=='done'" decoration-warning="state not in ('draft','cancel','done','assigned')"/>
            </tree>
        </field>
    </record>

    <record id="mz_view_picking_form" model="ir.ui.view">
        <field name="name">mz.stock.picking.form</field>
        <field name="model">stock.picking</field>
        <field name="arch" type="xml">
            <form string="Transferencia">
                <!-- Campos técnicos requeridos -->
                <field name="is_locked" invisible="1"/>
                <field name="show_check_availability" invisible="1"/>
                <field name="show_lots_text" invisible="1"/>
                <field name="picking_type_code" invisible="1"/>
                <field name="hide_picking_type" invisible="1"/>
                <field name="show_allocation" invisible="1"/>
                <field name="show_reserved" invisible="1"/>
                <field name="move_line_exist" invisible="1"/>
                <field name="has_packages" invisible="1"/>
                <field name="picking_type_entire_packs" invisible="1"/>
                <field name="use_create_lots" invisible="1"/>
                <field name="has_scrap_move" invisible="1"/>
                <field name="has_tracking" invisible="1"/>
                <field name="company_id" invisible="1"/>
                <field name="picking_properties" invisible="1"/>
                <field name="products_availability_state" invisible="1"/>
                <field name="json_popover" invisible="1"/>
                <header>
                    <button name="action_confirm" string="Confirmar" type="object" class="oe_highlight" invisible="state != 'draft'"/>

                    <button name="action_assign" string="Verificar Disponibilidad" type="object" class="oe_highlight" invisible="state not in ('confirmed', 'waiting')"/>

                    <button name="button_validate" string="Validar" type="object" class="oe_highlight" invisible="state not in ('assigned')"/>

                    <button name="action_cancel" string="Cancelar" type="object" invisible="state not in ('assigned', 'confirmed', 'draft', 'waiting')"/>

                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,assigned,done"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="priority" widget="priority" class="me-3"/>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="origin"/>
                            <field name="domain_location_id" invisible="1"/>
                            <field name="domain_location_dest_id" invisible="1"/>
                            <field name="location_id" options="{'no_create': True, 'domain_field': 'domain_location_id'}" readonly="state == 'done'" invisible="picking_type_code == 'incoming'"/>
                            <field name="location_dest_id" options="{'no_create': True, 'domain_field': 'domain_location_dest_id'}" readonly="state == 'done'" invisible="picking_type_code == 'outgoing'"/>
                        </group>
                        <group>
                            <field name="employee_id" readonly="1" force_save='1'/>
                            <field name="partner_id" readonly="1" force_save='1' invisible="1"/>
                            <field name="picking_type_id"/>
                            <field name="scheduled_date" readonly="1" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Operaciones" name="operations">
                            <field name="move_ids_without_package" context="{'default_company_id': company_id, 'default_picking_id': id, 'default_picking_type_id': picking_type_id, 'default_location_id': location_id, 'default_location_dest_id': location_dest_id}" readonly="state == 'done' and is_locked">
                                <tree editable="bottom">
                                    <field name="company_id" column_invisible="True"/>
                                    <field name="name" column_invisible="True"/>
                                    <field name="product_uom_category_id" column_invisible="True"/>
                                    <field name="is_initial_demand_editable" column_invisible="True"/>
                                    <field name="is_quantity_done_editable" column_invisible="True"/>
                                    <field name="product_id" required="1"/>
                                    <field name="location_id" column_invisible="parent.picking_type_code == 'incoming'" required="parent.picking_type_code != 'incoming'"/>
                                    <field name="location_dest_id" column_invisible="parent.picking_type_code == 'outgoing'" required="parent.picking_type_code != 'outgoing'"/>
                                    <field name="product_uom_qty" readonly="not is_initial_demand_editable"/>
                                    <field name="quantity" readonly="not is_quantity_done_editable"/>
                                    <field name="product_uom" groups="uom.group_uom" readonly="state != 'draft'" options="{'no_open': True, 'no_create': True}"/>
                                    <field name="state" invisible="1" />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="mz_view_picking_search" model="ir.ui.view">
        <field name="name">mz.stock.picking.search</field>
        <field name="model">stock.picking</field>
        <field name="arch" type="xml">
            <search string="Buscar Transferencias">
                <!-- Campos de búsqueda -->
                <field name="name" string="Referencia"/>
                <field name="partner_id"/>
                <field name="picking_type_id"/>
                <field name="location_id" groups="stock.group_stock_multi_locations"/>
                <field name="location_dest_id" groups="stock.group_stock_multi_locations"/>
                <field name="state"/>

                <!-- Filtros -->
                <filter string="Borradores" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="En Espera" name="waiting" domain="[('state', 'in', ('confirmed', 'waiting'))]"/>
                <filter string="Listos" name="ready" domain="[('state', '=', 'assigned')]"/>
                <filter string="Realizados" name="done" domain="[('state', '=', 'done')]"/>

                <!-- Agrupaciones -->
                <group expand="0" string="Agrupar Por">
                    <filter string="Estado" name="status" context="{'group_by': 'state'}"/>
                    <filter string="Tipo de Operación" name="picking_type" context="{'group_by': 'picking_type_id'}"/>
                    <filter string="Fecha Programada" name="expected_date" context="{'group_by': 'scheduled_date'}"/>
                </group>
            </search>
        </field>
    </record>
    <!-- Acciones de ventana -->

    <record id="mz_action_picking_tree_internal" model="ir.actions.act_window">
        <field name="name">Transferencias Internas</field>
        <field name="res_model">stock.picking</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('picking_type_id.code', '=', 'internal')]</field>
        <field name="context">{'contact_display': 'partner_address', 'default_company_id': allowed_company_ids[0], 'restricted_picking_type_code': 'internal', 'search_default_internal': 1,'filtrar_programa_picking': True}</field>
        <field name="view_ids" eval="[(5, 0, 0),
        (0, 0, {'view_mode': 'tree', 'view_id': ref('mz_view_picking_tree')}),
        (0, 0, {'view_mode': 'form', 'view_id': ref('mz_view_picking_form')})]"/>
    </record>

    <record id="mz_action_picking_tree_in" model="ir.actions.act_window">
        <field name="name">Recepciones</field>
        <field name="res_model">stock.picking</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('picking_type_id.code', '=', 'incoming')]</field>
        <field name="context">{'contact_display': 'partner_address', 'default_company_id': allowed_company_ids[0], 'restricted_picking_type_code': 'incoming', 'search_default_reception': 1,'filtrar_programa_picking': True}</field>
        <field name="view_ids" eval="[(5, 0, 0),
        (0, 0, {'view_mode': 'tree', 'view_id': ref('mz_view_picking_tree')}),
        (0, 0, {'view_mode': 'form', 'view_id': ref('mz_view_picking_form')})]"/>
    </record>


    <record id="mz_action_picking_tree_out" model="ir.actions.act_window">
        <field name="name">Entregas</field>
        <field name="res_model">stock.picking</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('picking_type_code', '=', 'outgoing')]</field>
        <field name="context">{'contact_display': 'partner_address', 'default_company_id': allowed_company_ids[0], 'restricted_picking_type_code': 'outgoing', 'search_default_delivery': 1,'filtrar_programa_picking': True}</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('mz_view_picking_tree')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('mz_view_picking_form')})]"/>
    </record>



    <!-- Elementos de menú -->
    <menuitem id="menu_mz_picking_in" name="Recepciones" action="mz_action_picking_tree_in" parent="menu_inv_traslados" sequence="10"/>

    <menuitem id="menu_mz_picking_out" name="Entregas" action="mz_action_picking_tree_out" parent="menu_inv_traslados" sequence="20"/>

    <menuitem id="menu_mz_picking_internal" name="Transferencias Internas" action="mz_action_picking_tree_internal" parent="menu_inv_traslados" sequence="30"/>

</odoo>